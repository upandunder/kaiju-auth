<!DOCTYPE html>

<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kaiju Authentication - Sofubi Verification</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: 'Arial', sans-serif;
        background: #2a2a2a;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        color: white;
    }

    .model-container {
        width: 100%;
        max-width: 600px;
        height: 400px;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        margin-bottom: 30px;
    }

    .model-container iframe {
        width: 100%;
        height: 100%;
        border: none;
    }

    .info-overlay {
        position: fixed;
        top: 20px;
        left: 20px;
        background: rgba(0, 0, 0, 0.8);
        padding: 20px;
        border-radius: 10px;
        border: 2px solid #FFD700;
        max-width: 300px;
        backdrop-filter: blur(10px);
    }

    .info-row {
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .info-label {
        font-size: 12px;
        color: #FFD700;
        font-weight: bold;
        text-transform: uppercase;
        margin-right: 10px;
    }

    .info-value {
        font-size: 14px;
        color: white;
        font-weight: normal;
    }

    .series-info {
        font-size: 16px;
        color: #FFD700;
        font-weight: bold;
        text-align: center;
        margin-top: 10px;
        padding: 10px;
        border: 1px solid #FFD700;
        border-radius: 5px;
    }

    .loading {
        color: #FFD700;
        font-style: italic;
    }

    .error {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #FF6B6B;
        font-weight: bold;
        background: rgba(0, 0, 0, 0.9);
        padding: 30px;
        border-radius: 10px;
        border: 2px solid #FF6B6B;
        text-align: center;
        max-width: 400px;
    }

    .instructions {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.7);
        padding: 15px;
        border-radius: 8px;
        font-size: 12px;
        color: #ccc;
        max-width: 200px;
    }

    @media (max-width: 768px) {
        .info-overlay {
            position: relative;
            top: auto;
            left: auto;
            width: 100%;
            max-width: 600px;
            margin-bottom: 20px;
        }
        
        .model-container {
            height: 300px;
        }
        
        .instructions {
            position: relative;
            bottom: auto;
            right: auto;
            width: 100%;
            max-width: 600px;
            text-align: center;
        }
    }
</style>
```

</head>
<body>
    <div class="info-overlay" id="infoPanel">
        <div class="info-row">
            <span class="info-label">Figura:</span>
            <span class="info-value" id="figure">Cargando...</span>
        </div>

```
    <div class="info-row">
        <span class="info-label">Versi√≥n:</span>
        <span class="info-value" id="version">Cargando...</span>
    </div>
    
    <div class="info-row">
        <span class="info-label">Propietario:</span>
        <span class="info-value" id="owner">Cargando...</span>
    </div>
    
    <div class="info-row">
        <span class="info-label">Fecha:</span>
        <span class="info-value" id="date">Cargando...</span>
    </div>
    
    <div class="series-info" id="series">
        Cargando serie...
    </div>
</div>

<div class="model-container">
    <div class="sketchfab-embed-wrapper">
        <iframe title="Kaiju Authentication Card" 
                allowfullscreen 
                mozallowfullscreen="true" 
                webkitallowfullscreen="true" 
                allow="autoplay; fullscreen; xr-spatial-tracking" 
                xr-spatial-tracking 
                execution-while-out-of-viewport 
                execution-while-not-rendered 
                web-share 
                src="https://sketchfab.com/models/d454500a4e644afd856e838b0299ac50/embed?autostart=0&ui_theme=dark&camera=0&ui_controls=1&ui_infos=0&ui_inspector=0&ui_watermark=0&ui_help=0&ui_settings=0&ui_vr=0&ui_fullscreen=0&ui_annotations=0&autospin=0.2&ui_stop=0&preload=1&transparent=0&background=2a2a2a&ui_hint=0&orbit_constraint_pan=false&orbit_constraint_zoom_in=1.2&orbit_constraint_zoom_out=3&orbit_constraint_rotate_x_min=-30&orbit_constraint_rotate_x_max=30">
        </iframe>
    </div>
</div>

<div class="instructions">
    <strong>üñ±Ô∏è Controles:</strong><br>
    ‚Ä¢ Arrastra para rotar<br>
    ‚Ä¢ Scroll para zoom<br>
    ‚Ä¢ La tarjeta no se puede voltear
</div>

<script>
    // Funci√≥n para obtener par√°metros de la URL
    function getUrlParameter(name) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(name);
    }

    // Funci√≥n para cargar datos desde Google Sheets
    async function loadKaijuData() {
        const kaijuId = getUrlParameter('id');
        
        if (!kaijuId) {
            showError('‚ö†Ô∏è URL INV√ÅLIDA<br><br>Esta p√°gina requiere un c√≥digo QR/NFC v√°lido.<br><br>Escanea el chip en la figura para acceder.');
            return;
        }

        try {
            // URL de tu Google Sheets en formato CSV
            const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRmcU3G4FSPHMgYE8uyqcYhOBx5pKTejEs30Q0GNs6q6sTensvYoO4u6ptMc37JeIBva2V0EW4GqFW_/pub?output=csv';
            
            const response = await fetch(sheetUrl);
            const csvText = await response.text();
            
            // Parsear CSV
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            // Buscar la fila con el ID espec√≠fico
            let kaijuData = null;
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                if (values[0] === kaijuId) {
                    kaijuData = {};
                    headers.forEach((header, index) => {
                        kaijuData[header] = values[index] || '';
                    });
                    break;
                }
            }

            if (kaijuData) {
                displayKaijuData(kaijuData);
            } else {
                showError(`‚ùå FIGURA NO ENCONTRADA<br><br>ID "${kaijuId}" no existe en nuestra base de datos.<br><br>Verifica que el chip NFC sea aut√©ntico.`);
            }

        } catch (error) {
            console.error('Error loading data:', error);
            showError('üîå ERROR DE CONEXI√ìN<br><br>No se puede conectar con la base de datos.<br><br>Verifica tu conexi√≥n a internet.');
        }
    }

    // Funci√≥n para mostrar los datos de la figura
    function displayKaijuData(data) {
        document.getElementById('figure').textContent = data.figure || 'N/A';
        document.getElementById('version').textContent = data.version || 'N/A';
        document.getElementById('owner').textContent = data.name || 'N/A';
        document.getElementById('date').textContent = formatDate(data.date_of_purchase) || 'N/A';
        
        // Formatear serie como "N√∫mero de Total - Nombre Serie"
        const seriesText = `${data.figure_number || '?'} de ${getTotalFromSeries(data.series_name)} - ${data.series_name || 'N/A'}`;
        document.getElementById('series').textContent = seriesText;
    }

    // Funci√≥n para extraer total de la serie (si est√° en formato "250" o "First Edition")
    function getTotalFromSeries(seriesName) {
        if (!seriesName) return '?';
        // Si el nombre contiene n√∫meros, intentar extraerlos
        const numbers = seriesName.match(/\d+/);
        return numbers ? numbers[0] : '‚àû';
    }

    // Funci√≥n para formatear fecha
    function formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleDateString('es-ES');
    }

    // Funci√≥n para mostrar errores
    function showError(message) {
        // Ocultar panel de info
        document.getElementById('infoPanel').style.display = 'none';
        
        // Crear overlay de error
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error';
        errorDiv.innerHTML = message;
        document.body.appendChild(errorDiv);
    }

    // Cargar datos al iniciar la p√°gina
    document.addEventListener('DOMContentLoaded', loadKaijuData);
</script>
```

</body>
</html>
